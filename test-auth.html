<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>yDance Auth Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .test-result { margin: 10px 0; padding: 10px; border-radius: 3px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
        button { padding: 10px 15px; margin: 5px; cursor: pointer; }
        .config-info { background: #fff3cd; color: #856404; padding: 15px; border-radius: 5px; margin: 20px 0; }
    </style>
</head>
<body>
    <h1>yDance Supabase Authentication Test</h1>
    
    <div class="config-info">
        <h3>üîß Supabase Backend Configuration Required:</h3>
        <p><strong>Current Config:</strong></p>
        <ul>
            <li>URL: https://rymcfymmigomaytblqml.supabase.co</li>
            <li>Key: sb_publishable_sk0GTezrQ8me8sPRLsWo4g_8UEQgztQ</li>
        </ul>
        <p><strong>Backend Setup Needed:</strong></p>
        <ul>
            <li>‚úÖ Enable email sign-up in Supabase dashboard</li>
            <li>‚úÖ Configure Site URL for redirects</li>
            <li>‚úÖ Set up email confirmation settings</li>
            <li>‚ùì Check if auth is enabled for this project</li>
        </ul>
    </div>
    
    <div class="test-section">
        <h3>Test 1: Supabase Client Initialization</h3>
        <button onclick="testSupabaseInit()">Test Supabase Init</button>
        <div id="supabase-result"></div>
    </div>
    
    <div class="test-section">
        <h3>Test 2: Auth UI Components</h3>
        <button onclick="testAuthUI()">Test Auth UI</button>
        <div id="auth-ui-result"></div>
    </div>
    
    <div class="test-section">
        <h3>Test 3: Sign Up Flow</h3>
        <button onclick="testSignUp()">Test Sign Up</button>
        <div id="signup-result"></div>
    </div>
    
    <div class="test-section">
        <h3>Test 4: Sign In Flow</h3>
        <button onclick="testSignIn()">Test Sign In</button>
        <div id="signin-result"></div>
    </div>
    
    <div class="test-section">
        <h3>Test 5: Auth State Management</h3>
        <button onclick="testAuthState()">Test Auth State</button>
        <div id="auth-state-result"></div>
    </div>

    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script src="script.js"></script>
    <script>
        // Test functions
        function testSupabaseInit() {
            const resultDiv = document.getElementById('supabase-result');
            try {
                if (typeof supabase !== 'undefined') {
                    resultDiv.innerHTML = '<div class="test-result success">‚úÖ Supabase library loaded successfully</div>';
                    
                    // Test client creation
                    const testClient = supabase.createClient(
                        'https://rymcfymmigomaytblqml.supabase.co',
                        'sb_publishable_sk0GTezrQ8me8sPRLsWo4g_8UEQgztQ'
                    );
                    
                    if (testClient) {
                        resultDiv.innerHTML += '<div class="test-result success">‚úÖ Supabase client created successfully</div>';
                    } else {
                        resultDiv.innerHTML += '<div class="test-result error">‚ùå Failed to create Supabase client</div>';
                    }
                } else {
                    resultDiv.innerHTML = '<div class="test-result error">‚ùå Supabase library not loaded</div>';
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="test-result error">‚ùå Error: ${error.message}</div>`;
            }
        }
        
        function testAuthUI() {
            const resultDiv = document.getElementById('auth-ui-result');
            try {
                const authStatusBar = document.getElementById('auth-status-bar');
                const loginBtn = document.getElementById('login-btn');
                const signupBtn = document.getElementById('signup-btn');
                const logoutBtn = document.getElementById('logout-btn');
                const authModal = document.getElementById('auth-modal');
                
                let results = [];
                
                if (authStatusBar) {
                    results.push('‚úÖ Auth status bar found');
                } else {
                    results.push('‚ùå Auth status bar missing');
                }
                
                if (loginBtn) {
                    results.push('‚úÖ Login button found');
                } else {
                    results.push('‚ùå Login button missing');
                }
                
                if (signupBtn) {
                    results.push('‚úÖ Signup button found');
                } else {
                    results.push('‚ùå Signup button missing');
                }
                
                if (logoutBtn) {
                    results.push('‚úÖ Logout button found');
                } else {
                    results.push('‚ùå Logout button missing');
                }
                
                if (authModal) {
                    results.push('‚úÖ Auth modal found');
                } else {
                    results.push('‚ùå Auth modal missing');
                }
                
                resultDiv.innerHTML = results.map(result => `<div class="test-result ${result.startsWith('‚úÖ') ? 'success' : 'error'}">${result}</div>`).join('');
            } catch (error) {
                resultDiv.innerHTML = `<div class="test-result error">‚ùå Error: ${error.message}</div>`;
            }
        }
        
        function testSignUp() {
            const resultDiv = document.getElementById('signup-result');
            try {
                const testEmail = 'test@example.com';
                const testPassword = 'testpassword123';
                
                resultDiv.innerHTML = '<div class="test-result info">üîÑ Testing sign up with test credentials...</div>';
                
                social.signUp(testEmail, testPassword).then(result => {
                    if (result.success) {
                        resultDiv.innerHTML = `<div class="test-result success">‚úÖ Sign up successful!<br>
                            User: ${result.user.email}<br>
                            Nostr Keys: ${result.keys.publicKey}</div>`;
                    } else {
                        resultDiv.innerHTML = '<div class="test-result error">‚ùå Sign up failed</div>';
                    }
                }).catch(error => {
                    resultDiv.innerHTML = `<div class="test-result error">‚ùå Sign up error: ${error.message}</div>`;
                });
            } catch (error) {
                resultDiv.innerHTML = `<div class="test-result error">‚ùå Error: ${error.message}</div>`;
            }
        }
        
        function testSignIn() {
            const resultDiv = document.getElementById('signin-result');
            try {
                const testEmail = 'test@example.com';
                const testPassword = 'testpassword123';
                
                resultDiv.innerHTML = '<div class="test-result info">üîÑ Testing sign in with test credentials...</div>';
                
                social.signIn(testEmail, testPassword).then(result => {
                    if (result.success) {
                        resultDiv.innerHTML = `<div class="test-result success">‚úÖ Sign in successful!<br>
                            User: ${result.user.email}<br>
                            Nostr Keys: ${result.keys.publicKey}</div>`;
                    } else {
                        resultDiv.innerHTML = '<div class="test-result error">‚ùå Sign in failed</div>';
                    }
                }).catch(error => {
                    resultDiv.innerHTML = `<div class="test-result error">‚ùå Sign in error: ${error.message}</div>`;
                });
            } catch (error) {
                resultDiv.innerHTML = `<div class="test-result error">‚ùå Error: ${error.message}</div>`;
            }
        }
        
        function testAuthState() {
            const resultDiv = document.getElementById('auth-state-result');
            try {
                const authState = social.testAuthState();
                
                resultDiv.innerHTML = `
                    <div class="test-result info">
                        <strong>Current Auth State:</strong><br>
                        User: ${authState.currentUser ? authState.currentUser.email : 'None'}<br>
                        Authenticated: ${authState.isAuthenticated}<br>
                        Session: ${authState.authSession ? 'Active' : 'None'}<br>
                        Nostr Keys: ${authState.userKeys ? authState.userKeys.publicKey : 'None'}
                    </div>
                `;
            } catch (error) {
                resultDiv.innerHTML = `<div class="test-result error">‚ùå Error: ${error.message}</div>`;
            }
        }
        
        // Initialize the app
        document.addEventListener('DOMContentLoaded', () => {
            console.log('Auth test page loaded');
        });
    </script>
</body>
</html>
